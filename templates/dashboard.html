<!DOCTYPE html>
<html lang="gu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Print Perfect A4 • Dashboard</title>
<style>
body{font-family:Arial,sans-serif;background:linear-gradient(135deg,#ffe6e6,#fff8f8);margin:0;padding:0;color:#000}
header{padding:20px 30px;background:linear-gradient(135deg,#fff0f0,#ffe6e6);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;border-bottom:4px solid #f08080;border-radius:0 0 12px 12px;box-shadow:0 5px 15px rgba(0,0,0,.1)}
.header-left button{margin-right:10px;padding:10px 18px;border-radius:8px;border:none;font-weight:bold;cursor:pointer;transition:all .3s}
.header-left button.home-btn{background:linear-gradient(135deg,#4CAF50,#2e7d32);color:#fff}
.header-left button.logout-btn{background:linear-gradient(135deg,#f44336,#b71c1c);color:#fff}
.header-left button:hover{opacity:.9}
.header-right{font-weight:bold;font-size:18px;color:#4d2c2c}
.header-center{width:100%;text-align:center;margin:15px 0}
.header-center h1{margin:0;font-size:42px;font-weight:900;color:#4d2c2c;text-shadow:2px 2px 6px rgba(0,0,0,0.2);letter-spacing:1px;font-family:'Arial Black','Segoe UI',sans-serif}
.header-center p{margin:6px 0;font-size:16px;font-weight:600;color:#5a3b3b;letter-spacing:.5px}
.container{width:90%;max-width:520px;margin:30px auto;padding:25px;border-radius:12px;text-align:center;background:linear-gradient(145deg,#fdf0f0,#ffe6e6);border:4px solid #f08080;box-shadow:0 10px 25px rgba(0,0,0,.12)}
.container input[type="file"]{width:100%;margin-bottom:15px;padding:10px;border-radius:8px;border:1px solid #ccc}
.container button{padding:12px 35px;font-size:16px;border:none;cursor:pointer;border-radius:8px;background:linear-gradient(135deg,#4CAF50,#2e7d32);color:#fff;font-weight:bold;margin-top:10px}
.card-options{display:flex;justify-content:center;gap:20px;margin-top:20px;flex-wrap:wrap}
.card-option{flex:1;padding:18px;border:2px solid #f08080;border-radius:12px;cursor:pointer;background:linear-gradient(145deg,#fff0f0,#ffe6e6);text-align:center;font-weight:bold;position:relative;transition:all .3s;min-width:120px}
.card-option input{display:none}
.card-option:hover{transform:translateY(-5px)}
.card-option.selected{border-color:#4CAF50;background:linear-gradient(145deg,#d0f0d0,#a8e6a3)}
.card-option.selected::after{content:'✔';color:#fff;background-color:#4CAF50;font-weight:bold;border-radius:50%;width:22px;height:22px;display:flex;align-items:center;justify-content:center;position:absolute;top:-10px;right:-10px;box-shadow:0 2px 5px rgba(0,0,0,.3)}
#fileList,#duplexFileList{display:flex;flex-wrap:wrap;justify-content:center;margin-top:15px;gap:10px}
#fileList img,#duplexFileList img{width:80px;height:50px;object-fit:cover;border:2px solid #f08080;border-radius:6px;transition:transform .3s}
#fileList img:hover,#duplexFileList img:hover{transform:scale(1.1)}
footer{text-align:center;margin:40px 0 20px 0;font-size:14px;font-weight:bold}
footer .titles{margin-bottom:10px}
footer .titles a{text-decoration:none;color:#000;margin:0 8px;transition:color .3s;cursor:pointer}
footer .titles a:hover{color:#f08080}
footer .titles a:not(:last-child)::after{content:" |";margin-left:8px}
.modal{display:none;position:fixed;z-index:999;top:0;left:0;width:100%;height:100%;overflow:auto;background:rgba(0,0,0,0.6);animation:fadeIn 0.4s}
.modal-content{background:#fff;margin:60px auto;padding:20px;border-radius:12px;width:90%;max-width:600px;max-height:80%;overflow-y:auto;animation:slideIn 0.4s}
.modal-close{float:right;font-size:22px;font-weight:bold;cursor:pointer;color:#f44336}
.flash-wrap{max-width:520px;margin:10px auto}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes slideIn{from{transform:translateY(-50px);opacity:0}to{transform:translateY(0);opacity:1}}
@media(max-width:600px){.card-options{flex-direction:column}.header-left button{margin-bottom:5px}}
.flex-row {
  display: flex;
  gap: 30px;
  justify-content: center;
  align-items: flex-start;
  flex-wrap: wrap;
}
.container {
  width: 100%;
  max-width: 520px;
  margin: 0;
  padding: 25px;
  border-radius: 12px;
  text-align: center;
  background: linear-gradient(145deg,#fdf0f0,#ffe6e6);
  border: 4px solid #f08080;
  box-shadow: 0 10px 25px rgba(0,0,0,.12);
}
@media(max-width:1100px){
  .flex-row { flex-direction: column; gap: 20px; }
  .container { margin: 0 auto 20px auto; }
}
#loader {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: rgba(255,255,255,0.7);
    z-index: 9999;
    justify-content: center;
    align-items: center;
  }
  .spinner {
    margin-bottom: 15px;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .spinner svg {
    animation: spin 1s linear infinite;
  }
  @keyframes spin { 100% { transform: rotate(360deg); } }
</style>
</head>
<body>
<header>
  <div class="header-left">
    <form action="{{ url_for('dashboard') }}" method="get" style="display:inline;">
      <button type="submit" class="home-btn">Home</button>
    </form>
    <form action="{{ url_for('logout') }}" method="get" style="display:inline;">
      <button type="submit" class="logout-btn">Logout</button>
    </form>
  </div>
  <div class="header-right">
    Welcome, {{ user }}!
  </div>
</header>

<div class="header-center">
  <h1>PRINTPERFECT A4</h1>
  <p>“Arrange any card, fit perfectly on A4.<br>Print ready in just one click.”</p>
</div>

<div class="flash-wrap">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{category}}" style="padding:10px 14px;border-radius:8px;border:1px solid #ddd;margin:8px;background:#fff;">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}
</div>

<div class="flex-row">
  <!-- Normal Crop Form -->
  <div class="container">
    <form method="post" enctype="multipart/form-data" action="{{ url_for('generate_card') }}">
      <input type="file" name="files" multiple required aria-label="Upload card images">
      <div id="fileList"></div>
      <button type="submit">Create PDF</button>
      <div class="card-options" aria-label="Card source" id="normalCardOptions">
        <label class="card-option selected">
          <input type="radio" name="mode" value="pmjay" checked> PMJAY PDF
        </label>
        <label class="card-option">
          <input type="radio" name="mode" value="image"> Another Image
        </label>
      </div>
    </form>
  </div>

  <!-- Duplex Crop Form (eShram) -->
  <div class="container">
    <form method="post" enctype="multipart/form-data" action="{{ url_for('generate_duplex_card') }}">
      <input type="file" name="files" multiple required aria-label="Upload eShram card images (front & back)">
      <div id="duplexFileList"></div>
      <button type="submit">Create Duplex PDF</button>
      <div class="card-options" id="duplexCardOptions">
        <label class="card-option selected">
          <input type="radio" name="mode" value="esharm" checked> eShram Duplex
        </label>
      </div>
    </form>
  </div>
</div>

<footer>
  <div class="titles">
    <a onclick="openModal('termsSummary')">Terms Summary</a>
    <a onclick="openModal('privacyPolicy')">Privacy Policy</a>
    <a onclick="openModal('termsUse')">Terms of Use</a>
    <a onclick="openModal('legalNotice')">Legal Notice</a>
    <a onclick="openModal('contact')">Contact</a>
    <a onclick="openModal('help')">Help</a>
    <a onclick="openModal('aboutUs')">About Us</a>
    <a onclick="openModal('information')">Information</a>
    <a onclick="openModal('faq')">FAQ</a>
  </div>
  &copy; 2025 Bhawin28
</footer>

<!-- Modal Structure -->
<div id="modal" class="modal">
  <div class="modal-content" id="modalContent">
    <span class="modal-close" onclick="closeModal()">&times;</span>
    <div id="modalBody"></div>
  </div>
</div>

<!-- Loader Animation (already present) -->
<div id="loader">
  <div style="text-align:center;">
    <div class="spinner">
      <svg width="60" height="60" viewBox="0 0 50 50">
        <circle cx="25" cy="25" r="20" fill="none" stroke="#f08080" stroke-width="6" stroke-linecap="round" stroke-dasharray="100" stroke-dashoffset="60"/>
      </svg>
    </div>
    <div style="font-size:18px;color:#f08080;font-weight:bold;">Creating PDF, please wait...</div>
  </div>
</div>

<!-- Download Box (hidden by default) -->
<div id="downloadBox" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(255,255,255,0.7);z-index:9999;justify-content:center;align-items:center;">
  <div style="background:#fff;padding:30px 40px;border-radius:16px;box-shadow:0 2px 12px #ccc;text-align:center;">
    <h2 style="color:#4CAF50;margin-bottom:18px;">PDF Created Successfully!</h2>
    <a id="downloadLink" href="{{ pdf_url }}" download style="display:inline-block;padding:12px 28px;background:#4CAF50;color:#fff;font-size:18px;font-weight:bold;border-radius:8px;text-decoration:none;box-shadow:0 2px 8px #eee;">Download PDF</a>
  </div>
</div>

<script>
// File preview - Normal
const input=document.querySelector('form[action="{{ url_for("generate_card") }}"] input[type="file"]');
const fileList=document.getElementById('fileList');
if(input){
  input.addEventListener('change', ()=>{
    fileList.innerHTML='';
    Array.from(input.files).forEach(file=>{
      const reader=new FileReader();
      reader.onload=e=>{
        const img=document.createElement('img');
        img.src=e.target.result;
        fileList.appendChild(img);
      };
      reader.readAsDataURL(file);
    });
  });
}

// File preview - Duplex
const duplexInput=document.querySelector('form[action="{{ url_for("generate_duplex_card") }}"] input[type="file"]');
const duplexFileList=document.getElementById('duplexFileList');
if(duplexInput){
  duplexInput.addEventListener('change', ()=>{
    duplexFileList.innerHTML='';
    Array.from(duplexInput.files).forEach(file=>{
      const reader=new FileReader();
      reader.onload=e=>{
        const img=document.createElement('img');
        img.src=e.target.result;
        duplexFileList.appendChild(img);
      };
      reader.readAsDataURL(file);
    });
  });
}

// --- Normal Card Options Selection Fix ---
const normalOptions=document.querySelectorAll('#normalCardOptions .card-option');
normalOptions.forEach(opt=>{
  opt.addEventListener('click', ()=>{
    normalOptions.forEach(o=>o.classList.remove('selected'));
    opt.classList.add('selected');
    opt.querySelector('input').checked=true;
  });
});

// --- Duplex Card Options Selection (only one, but keep for future) ---
const duplexOptions=document.querySelectorAll('#duplexCardOptions .card-option');
duplexOptions.forEach(opt=>{
  opt.addEventListener('click', ()=>{
    duplexOptions.forEach(o=>o.classList.remove('selected'));
    opt.classList.add('selected');
    opt.querySelector('input').checked=true;
  });
});

// Modal content
const modal=document.getElementById('modal');
const modalBody=document.getElementById('modalBody');
function openModal(section){
  const content={
    termsSummary:'Here is the summary of terms...',
    privacyPolicy:'When you upload PDF files to our website, they are processed to generate the output you need. We do not store your original files or use them for any other purpose. Your files are used only temporarily for processing and are deleted immediately after the output is generated.',
    termsUse:'This website is not free. By paying ₹149, you get access for 3 months. Once payment is made, you can use the service for 3 months. No refunds are provided.',
    legalNotice:'All content on this website is copyrighted and owned by us. Copying or reproducing the content without permission is strictly prohibited.',
    contact:'Phone: +91 94096 44628<br>Email: cbhawin28@gmail.com',
    help:'Contact support for help.',
    aboutUs:'Print Perfect A4 is an online service that helps you arrange your PDF files in perfect A4 format, ready for printing. Your files are kept private and secure, used only to generate the requested output.',
    information:'Additional info about our services.',
    faq:'Q1: Are my files safe?<br>A1: Yes, files are deleted after processing.<br>Q2: Cost?<br>A2: ₹149 for 3 months. No refunds.<br>Q3: Can I copy content?<br>A3: No.'
  };
  modalBody.innerHTML=content[section] || 'Content not available.';
  modal.style.display='block';
}
function closeModal(){modal.style.display='none'}
window.onclick=function(event){if(event.target==modal){closeModal()}}

  // Show loader on PDF form submit
  document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll('form[action="{{ url_for("generate_card") }}"], form[action="{{ url_for("generate_duplex_card") }}"]').forEach(function(form) {
      form.addEventListener('submit', function(e) {
        document.getElementById('loader').style.display = 'flex';
      });
    });
  });

  // Example: Show download box after PDF is created (simulate with JS)
  // In your Flask backend, after PDF is generated, render dashboard.html with a variable like pdf_url
  // Example: return render_template("dashboard.html", pdf_url=url_for('static', filename='output.pdf'))
  document.addEventListener("DOMContentLoaded", function() {
    {% if pdf_url %}
      // Hide loader
      document.getElementById('loader').style.display = 'none';
      // Show download box
      var downloadBox = document.getElementById('downloadBox');
      var downloadLink = document.getElementById('downloadLink');
      downloadBox.style.display = 'flex';
      downloadLink.href = "{{ pdf_url }}";
      // On click, download and refresh dashboard
      downloadLink.addEventListener('click', function() {
        setTimeout(function() {
          window.location.href = "{{ url_for('dashboard') }}";
        }, 1000); // 1 second after click
      });
    {% endif %}
  });
</script>
</body>
</html>
